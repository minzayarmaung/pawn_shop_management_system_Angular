<div class="signup-container">
  <div class="signup-card">
    <div class="signup-header">
      <h2>Create your account</h2>
      <div class="step-indicator">
        <div class="step" [class.active]="currentStep === 1" [class.completed]="currentStep > 1">
          <div class="step-number">1</div>
          <span>Email Verification</span>
        </div>
        <div class="step-line"></div>
        <div class="step" [class.active]="currentStep === 2" [class.completed]="currentStep > 2">
          <div class="step-number">2</div>
          <span>Account Details</span>
        </div>
      </div>
    </div>

    <!-- Step 1: Email Verification -->
    <form *ngIf="currentStep === 1" [formGroup]="emailForm" (ngSubmit)="sendOTP()" class="signup-form">
      <div class="form-group">
        <label for="email">Email address</label>
        <input 
          id="email" 
          name="email" 
          type="email" 
          formControlName="email"
          autocomplete="email" 
          placeholder="Enter your email address"
          [class.error]="emailForm.get('email')?.invalid && emailForm.get('email')?.touched">
        <div *ngIf="emailForm.get('email')?.invalid && emailForm.get('email')?.touched" class="error-message">
          <span *ngIf="emailForm.get('email')?.errors?.['required']">Email is required</span>
          <span *ngIf="emailForm.get('email')?.errors?.['email']">Please enter a valid email</span>
        </div>
      </div>

      <div class="form-group">
        <button type="submit" [disabled]="emailForm.invalid || isSendingOTP" class="btn-primary">
          <span *ngIf="isSendingOTP" class="spinner"></span>
          {{ isSendingOTP ? 'Sending OTP...' : 'Send OTP' }}
        </button>
      </div>

      <!-- OTP Input (shown after sending OTP) -->
      <div *ngIf="otpSent" class="form-group">
        <label for="otp">Enter OTP</label>
        <input 
          id="otp" 
          name="otp" 
          type="text" 
          formControlName="otp"
          placeholder="Enter 6-digit OTP"
          maxlength="6"
          [class.error]="emailForm.get('otp')?.invalid && emailForm.get('otp')?.touched">
        <div *ngIf="emailForm.get('otp')?.invalid && emailForm.get('otp')?.touched" class="error-message">
          <span *ngIf="emailForm.get('otp')?.errors?.['required']">OTP is required</span>
          <span *ngIf="emailForm.get('otp')?.errors?.['pattern']">OTP must be 6 digits</span>
        </div>
        <div class="otp-info">
          <span>Didn't receive OTP? </span>
          <button type="button" class="resend-btn" [disabled]="resendTimer > 0" (click)="resendOTP()">
            {{ resendTimer > 0 ? 'Resend in ' + resendTimer + 's' : 'Resend OTP' }}
          </button>
        </div>
      </div>

      <div *ngIf="otpSent" class="form-group">
        <button type="button" [disabled]="emailForm.get('otp')?.invalid || isVerifyingOTP" 
                (click)="verifyOTP()" class="btn-primary">
          <span *ngIf="isVerifyingOTP" class="spinner"></span>
          {{ isVerifyingOTP ? 'Verifying...' : 'Verify OTP' }}
        </button>
      </div>

      <div class="login-link">
        <span>Already have an account? </span>
        <a (click)="goToLogin()" class="login-text">Sign In</a>
      </div>
    </form>

    <!-- Step 2: Account Details -->
    <form *ngIf="currentStep === 2" [formGroup]="signupForm" (ngSubmit)="onSubmit()" class="signup-form">
      <div class="form-group">
        <label for="username">Username</label>
        <input 
          id="username" 
          name="username" 
          type="text" 
          formControlName="username"
          placeholder="Enter your username"
          [class.error]="signupForm.get('username')?.invalid && signupForm.get('username')?.touched">
        <div *ngIf="signupForm.get('username')?.invalid && signupForm.get('username')?.touched" class="error-message">
          <span *ngIf="signupForm.get('username')?.errors?.['required']">Username is required</span>
          <span *ngIf="signupForm.get('username')?.errors?.['minlength']">Username must be at least 3 characters</span>
        </div>
      </div>

      <div class="form-group">
        <label for="signupEmail">Email address</label>
        <input 
          id="signupEmail" 
          name="signupEmail" 
          type="email" 
          formControlName="email"
          readonly
          class="readonly-field">
      </div>

      <div class="form-group">
        <label for="signupPassword">Password</label>
        <div class="password-input">
          <input 
            id="signupPassword" 
            name="signupPassword" 
            [type]="showPassword ? 'text' : 'password'" 
            formControlName="password"
            placeholder="Enter your password"
            [class.error]="signupForm.get('password')?.invalid && signupForm.get('password')?.touched">
          <button type="button" class="toggle-password" (click)="togglePassword()">
            <i [class]="showPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
          </button>
        </div>
        <div *ngIf="signupForm.get('password')?.invalid && signupForm.get('password')?.touched" class="error-message">
          <span *ngIf="signupForm.get('password')?.errors?.['required']">Password is required</span>
          <span *ngIf="signupForm.get('password')?.errors?.['minlength']">Password must be at least 6 characters</span>
        </div>
      </div>

      <div class="form-group">
        <label for="confirmPassword">Confirm Password</label>
        <div class="password-input">
          <input 
            id="confirmPassword" 
            name="confirmPassword" 
            [type]="showConfirmPassword ? 'text' : 'password'" 
            formControlName="confirmPassword"
            placeholder="Confirm your password"
            [class.error]="signupForm.get('confirmPassword')?.invalid && signupForm.get('confirmPassword')?.touched">
          <button type="button" class="toggle-password" (click)="toggleConfirmPassword()">
            <i [class]="showConfirmPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
          </button>
        </div>
        <div *ngIf="signupForm.get('confirmPassword')?.invalid && signupForm.get('confirmPassword')?.touched" class="error-message">
          <span *ngIf="signupForm.get('confirmPassword')?.errors?.['required']">Please confirm your password</span>
          <span *ngIf="signupForm.get('confirmPassword')?.errors?.['mismatch']">Passwords do not match</span>
        </div>
      </div>

      <div class="form-group">
        <label for="signupRole">Role</label>
        <select id="signupRole" formControlName="role" [class.error]="signupForm.get('role')?.invalid && signupForm.get('role')?.touched">
          <option value="">Select Role</option>
          <option value="admin">Admin</option>
          <option value="staff">Staff</option>
        </select>
        <div *ngIf="signupForm.get('role')?.invalid && signupForm.get('role')?.touched" class="error-message">
          <span *ngIf="signupForm.get('role')?.errors?.['required']">Role is required</span>
        </div>
      </div>

      <div class="form-actions">
        <button type="button" (click)="goBack()" class="btn-secondary">
          <i class="fas fa-arrow-left"></i>
          Back
        </button>
        <button type="submit" [disabled]="signupForm.invalid || isLoading" class="btn-primary">
          <span *ngIf="isLoading" class="spinner"></span>
          {{ isLoading ? 'Creating Account...' : 'Create Account' }}
        </button>
      </div>

      <div class="login-link">
        <span>Already have an account? </span>
        <a (click)="goToLogin()" class="login-text">Sign In</a>
      </div>
    </form>
  </div>
</div>