<div class="signup-container">
  <div class="signup-card">
    <div class="signup-header">
      <h2>Reset Password</h2>
      <div class="step-indicator">
        <div class="step" [class.active]="currentStep === 1" [class.completed]="currentStep > 1">
          <div class="step-number">1</div>
          <span>Email Verification</span>
        </div>
        <div class="step-line"></div>
        <div class="step" [class.active]="currentStep === 2" [class.completed]="currentStep > 2">
          <div class="step-number">2</div>
          <span>New Password</span>
        </div>
      </div>
    </div>

    <!-- Step 1: Email Verification -->
    <form *ngIf="currentStep === 1" [formGroup]="emailForm" (ngSubmit)="sendOTP()" class="signup-form">
      <!-- Email Input (only show if OTP not sent) -->
      <div *ngIf="!otpSent" class="form-group">
        <label for="email">Email address</label>
        <input 
          id="email" 
          name="email" 
          type="email" 
          formControlName="email"
          autocomplete="email" 
          placeholder="Enter your registered email address"
          [class.error]="emailForm.get('email')?.invalid && emailForm.get('email')?.touched">
        <div *ngIf="emailForm.get('email')?.invalid && emailForm.get('email')?.touched" class="error-message">
          <span *ngIf="emailForm.get('email')?.errors?.['required']">Email is required</span>
          <span *ngIf="emailForm.get('email')?.errors?.['email']">Please enter a valid email</span>
        </div>
      </div>

      <!-- Send OTP Button (only show if OTP not sent) -->
      <div *ngIf="!otpSent" class="form-group">
        <button type="submit" [disabled]="emailForm.invalid || isSendingOTP" class="btn-primary">
          <span *ngIf="isSendingOTP" class="spinner"></span>
          {{ isSendingOTP ? 'Sending OTP...' : 'Send OTP' }}
        </button>
      </div>

      <!-- OTP Input (shown after sending OTP) -->
      <div *ngIf="otpSent" class="form-group">
        <label for="otp">Enter OTP</label>
        <input 
          id="otp" 
          name="otp" 
          type="text" 
          formControlName="otp"
          placeholder="Enter 6-digit OTP"
          maxlength="6"
          [class.error]="emailForm.get('otp')?.invalid && emailForm.get('otp')?.touched">
        <div *ngIf="emailForm.get('otp')?.invalid && emailForm.get('otp')?.touched" class="error-message">
          <span *ngIf="emailForm.get('otp')?.errors?.['required']">OTP is required</span>
          <span *ngIf="emailForm.get('otp')?.errors?.['pattern']">OTP must be 6 digits</span>
        </div>
        <div class="otp-info">
          <span>Didn't receive OTP? </span>
          <button type="button" class="resend-btn" [disabled]="resendTimer > 0" (click)="resendOTP()">
            {{ resendTimer > 0 ? 'Resend in ' + resendTimer + 's' : 'Resend OTP' }}
          </button>
        </div>
      </div>

      <!-- Verify OTP Button (only show after OTP sent) -->
      <div *ngIf="otpSent" class="form-group">
        <button type="button" [disabled]="emailForm.get('otp')?.invalid || isVerifyingOTP" 
                (click)="verifyOTP()" class="btn-primary">
          <span *ngIf="isVerifyingOTP" class="spinner"></span>
          {{ isVerifyingOTP ? 'Verifying...' : 'Verify OTP' }}
        </button>
      </div>

      <div class="login-link">
        <span>Remember your password? </span>
        <a (click)="goToLogin()" class="login-text">Sign In</a>
      </div>
    </form>

    <!-- Step 2: Reset Password -->
    <form *ngIf="currentStep === 2" [formGroup]="resetPasswordForm" (ngSubmit)="resetPassword()" class="signup-form">
      <div class="form-group">
        <label for="newPassword">New Password</label>
        <div class="password-input">
          <input 
            id="newPassword" 
            name="newPassword" 
            [type]="showNewPassword ? 'text' : 'password'" 
            formControlName="newPassword"
            placeholder="Enter your new password"
            [class.error]="resetPasswordForm.get('newPassword')?.invalid && resetPasswordForm.get('newPassword')?.touched">
          <button type="button" class="toggle-password" (click)="toggleNewPassword()">
            <i [class]="showNewPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
          </button>
        </div>
        <div *ngIf="resetPasswordForm.get('newPassword')?.invalid && resetPasswordForm.get('newPassword')?.touched" class="error-message">
          <span *ngIf="resetPasswordForm.get('newPassword')?.errors?.['required']">New password is required</span>
          <span *ngIf="resetPasswordForm.get('newPassword')?.errors?.['minlength']">Password must be at least 6 characters</span>
        </div>
      </div>

      <div class="form-group">
        <label for="confirmPassword">Confirm New Password</label>
        <div class="password-input">
          <input 
            id="confirmPassword" 
            name="confirmPassword" 
            [type]="showConfirmPassword ? 'text' : 'password'" 
            formControlName="confirmPassword"
            placeholder="Confirm your new password"
            [class.error]="resetPasswordForm.get('confirmPassword')?.invalid && resetPasswordForm.get('confirmPassword')?.touched">
          <button type="button" class="toggle-password" (click)="toggleConfirmPassword()">
            <i [class]="showConfirmPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
          </button>
        </div>
        <div *ngIf="resetPasswordForm.get('confirmPassword')?.invalid && resetPasswordForm.get('confirmPassword')?.touched" class="error-message">
          <span *ngIf="resetPasswordForm.get('confirmPassword')?.errors?.['required']">Please confirm your new password</span>
          <span *ngIf="resetPasswordForm.get('confirmPassword')?.errors?.['mismatch']">Passwords do not match</span>
        </div>
      </div>

      <div class="form-actions">
        <button type="button" (click)="goBack()" class="btn-secondary">
          <i class="fas fa-arrow-left"></i>
          Back
        </button>
        <button type="submit" [disabled]="resetPasswordForm.invalid || isResettingPassword" class="btn-primary">
          <span *ngIf="isResettingPassword" class="spinner"></span>
          {{ isResettingPassword ? 'Resetting Password...' : 'Reset Password' }}
        </button>
      </div>

      <div class="login-link">
        <span>Remember your password? </span>
        <a (click)="goToLogin()" class="login-text">Sign In</a>
      </div>
    </form>
  </div>
</div>